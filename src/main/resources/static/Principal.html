<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Chilape√±os</title>
    <link rel="stylesheet" href="css/styles.css">

    <!-- Iconos (Font Awesome) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        /* ===========================
           Estilos principales (MANTIENEN TU DISE√ëO ORIGINAL)
           =========================== */
        body {
            background-color: #ffffff;
            color: #222;
            transition: background-color 0.3s, color 0.3s;
            margin: 0;
            font-family: Arial, sans-serif;
        }

        /* Navbar (sticky para que el c√°lculo del offset funcione) */
        .navbar {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 15px;
            background-color: #ff6600;
            position: sticky;
            top: 0;
            z-index: 999;
        }

        .navbar a {
            color: white;
            text-decoration: none;
            font-weight: bold;
            padding: 8px 16px;
            border-radius: 25px;
            transition: all 0.3s ease;
        }

        .navbar a:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .navbar a.active {
            background-color: #FFD700;
            color: #333;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* ===========================
           NUEVOS ESTILOS PARA AUTENTICACI√ìN
           =========================== */
        .admin-only {
            display: none;
        }

        .cliente-only {
            display: block;
        }

        /* Indicador de usuario en navbar
           -> Movido m√°s hacia la izquierda para evitar choque con el bot√≥n de notificaciones.
           -> z-index cuidado para que el dropdown de notificaciones quede por encima si se superponen.
        */
        .user-indicator {
            position: fixed;
            top: 12px;
            right: 120px;            /* separado del borde derecho (evita choque con notificaciones) */
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 13px;
            z-index: 1000;           /* por debajo del dropdown (1003) pero por encima de la navbar */
            white-space: nowrap;     /* evita salto de l√≠nea inesperado */
        }

        .role-admin {
            background: #ffd54f;
            color: #f57f17;
        }

        .role-cliente {
            background: #c8e6c9;
            color: #2e7d32;
        }

        /* Sistema de notificaciones */
        .notification-container {
            position: fixed;
            top: 10px;
            right: 12px;             /* notificaciones pegadas al borde derecho */
            z-index: 1002;
            display: none;
        }

        .notification-btn {
            position: relative;
            background: #ff6600;
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            font-size: 18px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .notification-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            min-width: 20px;
        }

        .notification-dropdown {
            position: absolute;
            top: 55px;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            min-width: 320px;
            max-width: 400px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 1003;
        }

        body.dark-mode .notification-dropdown {
            background: #2d2d2d;
            border-color: #444;
            color: #eee;
        }

        .notification-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
            font-weight: bold;
            color: #333;
            background: #f8f9fa;
            border-radius: 10px 10px 0 0;
        }

        body.dark-mode .notification-header {
            background: #3d3d3d;
            color: #eee;
            border-bottom-color: #555;
        }

        .notification-item {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .notification-item:hover {
            background-color: #f8f9fa;
        }

        body.dark-mode .notification-item {
            border-bottom-color: #444;
        }

        body.dark-mode .notification-item:hover {
            background-color: #3d3d3d;
        }

        .notification-item:last-child {
            border-bottom: none;
            border-radius: 0 0 10px 10px;
        }

        .notification-item.unread {
            background-color: #e3f2fd;
            border-left: 3px solid #2196f3;
        }

        body.dark-mode .notification-item.unread {
            background-color: #1a237e;
            border-left-color: #64b5f6;
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: 4px;
            color: #333;
        }

        body.dark-mode .notification-title {
            color: #eee;
        }

        .notification-text {
            font-size: 13px;
            color: #666;
            margin-bottom: 4px;
        }

        body.dark-mode .notification-text {
            color: #ccc;
        }

        .notification-time {
            font-size: 11px;
            color: #999;
        }

        body.dark-mode .notification-time {
            color: #888;
        }

        .notification-actions {
            padding: 10px 15px;
            border-top: 1px solid #eee;
            text-align: center;
        }

        body.dark-mode .notification-actions {
            border-top-color: #555;
        }

        .clear-notifications {
            background: none;
            border: none;
            color: #ff6600;
            cursor: pointer;
            font-size: 13px;
            text-decoration: underline;
        }

        .clear-notifications:hover {
            color: #e55a00;
        }

        .no-notifications {
            padding: 20px 15px;
            text-align: center;
            color: #999;
            font-style: italic;
        }

        body.dark-mode .no-notifications {
            color: #777;
        }

        /* Hero */
        .hero-fastfood {
            background: #111;
            color: #fff;
            padding: 60px 20px;
        }

        .hero-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            max-width: 1200px;
            margin: auto;
            gap: 30px;
        }

        .hero-text {
            flex: 1;
            min-width: 280px;
        }

        .hero-text .highlight {
            font-size: 2rem;
            font-style: italic;
            color: #FFD700;
            margin: 0;
        }

        .hero-text h1 {
            font-size: 3.5rem;
            font-weight: 900;
            margin: 10px 0;
            text-transform: uppercase;
        }

        .hero-text h4 {
            font-size: 1.5rem;
            margin: 10px 0;
            font-weight: 600;
        }

        .hero-text p {
            font-size: 1rem;
            line-height: 1.6;
            margin: 15px 0 25px;
            color: #ccc;
            max-width: 450px;
        }

        .btn-register {
            display: inline-block;
            padding: 12px 25px;
            background: #FFD700;
            color: #111;
            font-weight: bold;
            border-radius: 30px;
            text-decoration: none;
            transition: 0.3s;
            cursor: pointer;
        }

        .btn-register:hover {
            background: #ffb400;
            transform: translateY(-3px);
        }

        .hero-image {
            flex: 1;
            display: flex;
            justify-content: center;
            min-width: 280px;
        }

        .circle {
            border: 6px solid #FFD700;
            border-radius: 50%;
            padding: 10px;
            overflow: hidden;
            max-width: 350px;
            max-height: 350px;
        }

        .circle img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            transition: transform 0.4s ease-in-out;
        }

        .circle img:hover {
            transform: scale(1.1);
        }

        /* ===========================
           Dise√±o de tarjetas (basado en Entradas)
           =========================== */
        .categorias {
            max-width: 1200px;
            margin: 20px auto 40px;
            padding: 0 20px;
        }

        .banner {
            text-align: center;
            font-weight: bold;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #ffe6cc;
            color: #333;
            border-radius: 5px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 30px;
        }

        /* Reemplazamos la apariencia antigua de .card por el estilo de .item */
        .card {
            background-color: #ffffff;
            border-radius: 15px;
            padding: 18px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            border: 2px solid transparent;
            text-align: left;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(255,102,0,0.14);
            border-color: #ff6600;
        }

        .card img {
            width: 100%;
            height: 200px;              /* altura fija similar al ejemplo */
            object-fit: cover;
            border-radius: 10px;
            display: block;
            margin-bottom: 12px;
        }

        .card h3 {
            color: #ff6600;             /* t√≠tulo naranja */
            font-size: 1.25rem;
            margin: 6px 0 8px 0;
            font-weight: 700;
        }

        .card p {
            color: #666;
            line-height: 1.6;
            margin: 0;
            font-size: 0.95rem;
        }

        /* ===========================
           SECCIONES ADMIN (NUEVAS)
           =========================== */
        .admin-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            margin: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .admin-section h2 {
            color: #FFD700;
            margin-bottom: 20px;
            text-align: center;
        }

        .admin-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .admin-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            text-decoration: none;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s;
            cursor: pointer;
            font-size: 14px;
        }

        .admin-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #FFD700;
        }

        .user-list {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .role-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        /* ===========================
           NUEVA SECCI√ìN: Anuncio para administradores en Inicio
           (aparece en lugar del panel local cuando el usuario es admin)
           =========================== */
        .admin-announcement {
            max-width: 1100px;
            margin: 20px auto;
            padding: 22px;
            border-radius: 12px;
            background: linear-gradient(90deg,#ffd54f10,#fff2cc);
            border: 1px solid rgba(255,215,0,0.15);
            display: none; /* por defecto oculto, se muestra v√≠a JS cuando corresponde */
            text-align: center;
        }
        .admin-announcement h3 {
            color: #ff8c00;
            margin: 0 0 8px 0;
            font-size: 1.15rem;
        }
        .admin-announcement p {
            color: #5a3d00;
            margin: 0 0 12px 0;
        }
        .admin-announcement a {
            display:inline-block;
            background:#ff6600;
            color:#fff;
            padding:8px 14px;
            border-radius:20px;
            text-decoration:none;
            font-weight:bold;
        }

        /* Si quieres centrar t√≠tulos en pantallas peque√±as (opcional) */
        @media (max-width: 480px) {
            .card h3 { text-align: left; }
        }

        /* ===========================
           Footer y botones flotantes
           =========================== */
        footer {
            background-color: #2d0c88;
            color: #fff;
            padding: 20px;
            text-align: center;
            margin-top: 40px;
        }

        footer h3 { color: #FFD700; }

        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            text-align: left;
            padding: 20px;
        }

        .footer-logo img { max-width: 120px; margin-bottom: 10px; }

        .floating-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }

        .floating-buttons a,
        .floating-buttons button {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #ff6600;
            color: #fff;
            font-size: 22px;
            text-decoration: none;
            box-shadow: 0px 4px 8px rgba(0,0,0,0.3);
            transition: transform 0.2s ease-in-out;
            border: none;
            cursor: pointer;
        }

        .floating-buttons a:hover,
        .floating-buttons button:hover {
            transform: scale(1.1);
        }

        .btn-whatsapp { background-color: #25D366; }
        .btn-chat { background-color: #0078FF; }
        .btn-logout { background-color: #dc3545; }
        .btn-dark { background-color: #111; }

        /* Modo oscuro */
        body.dark-mode {
            background-color: #121212;
            color: #eee;
        }

        body.dark-mode .card {
            background-color: #1e1e1e;
            color: #eee;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        body.dark-mode .card h3 { color: #ff944d; }
        body.dark-mode .card p { color: #ccc; }

        body.dark-mode footer {
            background-color: #211d2f;
            color: #ccc;
        }
        /* Quitar subrayado en las secciones del men√∫ */
        .categorias h2,
        .categorias a {
        text-decoration: none !important;
        border-bottom: none !important;
       }


        /* ---------------------------
           Estilos del carrito (izquierda)
           --------------------------- */
        .cart-left {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: none; /* por defecto oculto; se muestra s√≥lo para clientes v√≠a JS */
            align-items: center;
            justify-content: center;
            background: #FF8C00;
            color: #fff;
            font-size: 22px;
            text-decoration: none;
            box-shadow: 0px 4px 8px rgba(0,0,0,0.3);
            border: none;
            cursor: pointer;
            z-index: 1001; /* por encima de navbar pero debajo de notificaciones si fuera necesario */
        }
        .cart-left:hover { transform: scale(1.06); }

        .cart-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            min-width: 20px;
            height: 20px;
            padding: 0 5px;
            border-radius: 999px;
            background: #dc3545;
            color: white;
            font-weight: 700;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Modal carrito */
        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items:center; justify-content:center; z-index:2000; }
        .modal { background: #fff; border-radius: 12px; max-width: 820px; width: 95%; max-height: 85vh; overflow:auto; padding: 18px; box-shadow: 0 12px 36px rgba(0,0,0,0.3); }
        .modal h3 { margin: 0 0 12px 0; }
        .modal .modal-body { margin-bottom: 12px; }
        .cart-item { display:flex; gap:12px; align-items:center; padding:10px 0; border-bottom:1px solid #eee; }
        .cart-item img { width:72px; height:56px; object-fit:cover; border-radius:6px; }
        .cart-item .meta { flex:1; }
        .qty-controls { display:flex; gap:6px; align-items:center; }
        .qty-controls button { width:32px; height:32px; border-radius:6px; border:1px solid #ddd; background:#fff; cursor:pointer; }
        .remove-btn { background:transparent; color:#dc3545; border:none; cursor:pointer; font-weight:700; }

        .modal-footer { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; }
        .btn-primary { background:#ff6600; color:#fff; border:none; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700; }
        .btn-secondary { background:#eee; color:#333; border:none; padding:10px 12px; border-radius:10px; cursor:pointer; }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-container { flex-direction: column; text-align: center; }
            .hero-image { margin-top: 20px; }
            .grid { gap: 18px; }
            .card img { height: 180px; }
            
            /* Ajustes para m√≥viles - elementos superiores */
            .user-indicator { 
                right: 10px; 
                top: 6px; 
                font-size: 11px;
                padding: 4px 8px;
            }
            .notification-container { 
                right: 55px; 
                top: 35px;
            }
            .notification-btn {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            .notification-dropdown {
                min-width: 280px;
                max-width: 90vw;
            }
            
            .admin-buttons { grid-template-columns: 1fr; }

            .cart-left { left: 12px; bottom: 15px; width:50px; height:50px; font-size:18px; }
        }

    </style>
</head>
<body>

<!-- Indicador de usuario (esquina superior derecha) -->
<div class="user-indicator" id="userIndicator" style="display: none;">
    <span id="userEmail"></span> | <span id="userRoleDisplay" class="role-badge"></span>
</div>

<!-- Sistema de notificaciones -->
<div class="notification-container" id="notificationContainer" style="display: none;">
    <button class="notification-btn" id="notificationBtn" onclick="toggleNotifications()">
        <i class="fas fa-bell"></i>
        <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
    </button>
    <div class="notification-dropdown" id="notificationDropdown">
        <div class="notification-header">
            <i class="fas fa-bell"></i> Notificaciones
        </div>
        <div id="notificationsList">
            <div class="no-notifications">No hay notificaciones</div>
        </div>
        <div class="notification-actions">
            <button class="clear-notifications" onclick="clearNotifications()">Marcar todas como le√≠das</button>
        </div>
    </div>
</div>

<!-- Barra superior -->
<nav class="navbar">
    <a href="Principal.html" class="active">Inicio</a>
    <a href="Eventos.html">Eventos</a>
    <a href="contacto.html">Cont√°ctanos</a>
    <!-- Enlaces solo para administradores -->
    <a href="PanelAdmin.html" class="admin-only">Panel Admin</a>

</nav>

<!-- Hero -->
<section class="hero-fastfood">
    <div class="hero-container">
        <div class="hero-text">
            <h3 class="highlight">Saz√≥n Mexicano</h3>
            <h1>CHILAPE√ëO</h1>
            <h4>Tradici√≥n con mucho sabor</h4>
            <p id="heroBienvenida">
                Comida tradicional Mexicana, disfruta del mejor sabor mexicano sin picante... pero conservando nuestro toque secreto
            </p>
            <a class="btn-register" id="scrollToMenu">Explora el men√∫</a>
        </div>

        <div class="hero-image">
            <div class="circle">
                <img src="imagenes/varios/Goku.jpg" alt="Plato chilape√±o">
            </div>
        </div>
    </div>
</section>

<!-- Inicio (sin botones MEN√ö y PEDIR DOMICILIO) -->
<section class="inciio">
    <div class="inicio-content" style="text-align:center;padding:40px;">
        <h1 id="tituloInicio">¬øQu√© te provoca hoy?</h1>
        <div class="buttons" style="margin-top: 20px;">
            <!-- botones removidos intencionalmente -->
        </div>
    </div>
</section>

<!-- === Nueva secci√≥n: anuncio para administradores (se muestra en inicio cuando admin) === -->
<section id="adminAnnouncement" class="admin-announcement" style="display:none;">
    <h3>Panel de Administrador Disponible</h3>
    <p>Est√°s conectado como administrador. Para gestionar el sistema, utiliza el Panel de Administrador dedicado.</p>
    <a href="PanelAdmin.html">Abrir Panel Admin</a>
</section>

<!-- Categor√≠as (destino del scroll) -->
<section id="categorias" class="categorias">
    <p class="banner">
        Todos nuestros domicilios tienen recargo dependiendo del lugar del domicilio
    </p>

    <div class="grid">
        <!-- Card 1 -->
        <div class="card">
            <a href="opciones/Entradas.html">
                <img src="imagenes/varios/Pro.Entradas.png" alt="Entradas">
                <h3>Entradas</h3>
                <p>Te mostramos nuestras entradas m√°s populares: tacos, quesadillas, nachos y m√°s.</p>
            </a>
        </div>

        <!-- Card 2 -->
        <div class="card">
            <a href="opciones/PlatosFuertes.html">
                <img src="imagenes/varios/Pro.Plato Fuerte.png" alt="Platos Fuertes">
                <h3>Platos Fuertes</h3>
                <p>Platos contundentes con sabores tradicionales y porciones generosas.</p>
            </a>
        </div>

        <!-- Card 3 -->
        <div class="card">
            <a href="opciones/Bebidas.html">
                <img src="imagenes/varios/Pro.Bebidas.png" alt="Bebidas">
                <h3>Bebidas</h3>
                <p>Refrescos, aguas y bebidas tradicionales para acompa√±ar tu comida.</p>
            </a>
        </div>

        <!-- Card 4 -->
        <div class="card">
            <a href="opciones/Postres.html">
                <img src="imagenes/varios/Pro.Postres.png" alt="Postres">
                <h3>Postres</h3>
                <p>Dulces finales para cerrar con broche de oro.</p>
            </a>
        </div>

    </div>
</section>

<!-- Footer -->
<footer class="footer">
    <div class="footer-container">
        <div class="footer-logo">
            <img src="imagenes/varios/logo.png" alt="logo chilape√±os">
            <p>Ya viste nuestro men√∫ ¬øQu√© quieres pedir hoy?<br>
                Pide tu domicilio en nuestro WhatsApp o ll√°manos al <br><strong>314 4230347</strong></p>
        </div>

        <div class="footer-info">
            <h3>Horario de atenci√≥n</h3>
            <p>Lunes a jueves: 1:00 p.m ‚Äì 10:00 p.m</p>
            <p>Viernes y s√°bado: 1:00 p.m ‚Äì 12:00 a.m</p>
            <p>Domingos: 1:00 p.m ‚Äì 9:00 p.m</p>

            <h3>M√©todos de pago</h3>
            <p><strong>En nuestro restaurante:</strong> Efectivo, tarjetas d√©bito/cr√©dito, Nequi / Daviplata</p>
            <p><strong>Domicilios:</strong> Efectivo, tarjetas d√©bito/cr√©dito, plataformas de pago</p>
        </div>

        <div class="footer-contact">
            <h3>Cont√°ctanos</h3>
            <p>üìç Normand√≠a sobre la CALLE 63 #78-25, Bogot√°</p>
            <p>üìû Domicilios: 314 4230347 </p>
        </div>
    </div>

    <p class="footer-copy">software3 | Copyright ¬© 2025 
        <span>chilape√±itos.com</span> - Todos los derechos reservados
    </p>
</footer>

<!-- Botones flotantes -->
<div class="floating-buttons">
    <a href="login.html" class="btn-login" id="loginFloatingBtn" title="Iniciar Sesi√≥n"><i class="fas fa-user"></i></a>
    <button class="btn-logout" id="logoutBtn" onclick="cerrarSesion()" title="Cerrar Sesi√≥n" style="display: none;"><i class="fas fa-sign-out-alt"></i></button>
    <a href="https://wa.me/573144230347" target="_blank" class="btn-whatsapp" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
    <button class="btn-chat" title="ChatBot"><i class="fas fa-robot"></i></button>
    <button class="btn-dark" id="darkModeToggle" title="Modo oscuro / claro"><i class="fas fa-moon"></i></button>
</div>

<!-- Bot√≥n Carrito en IZQUIERDA inferior (solo para clientes: se muestra v√≠a JS) -->
<button id="cartLeftBtn" class="cart-left" title="Ver carrito" aria-label="Ver carrito">
    <i class="fas fa-shopping-cart"></i>
    <div id="cartLeftBadge" class="cart-badge" style="display:none">0</div>
</button>

<!-- Modal backdrop (carrito / auth prompt) -->
<div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div id="modal" class="modal" role="dialog" aria-modal="true"></div>
</div>

<!-- Scripts -->
<script>
    // ===========================
    // SISTEMA DE AUTENTICACI√ìN
    // ===========================
    
    // Verificar autenticaci√≥n al cargar
    document.addEventListener('DOMContentLoaded', function() {
        checkAuthentication();
        initializeUI();
        // actualizar badge del carrito si existe (por si venimos desde otra p√°gina)
        updateCartBadge();
    });

    function checkAuthentication() {
        const currentUser = localStorage.getItem('currentUser');
        const userRole = localStorage.getItem('userRole');

        if (currentUser && userRole) {
            // Hay sesi√≥n activa, configurar UI seg√∫n el rol
            setupUserInterface(currentUser, userRole);
        } else {
            // No hay sesi√≥n, configurar modo invitado
            setupGuestInterface();
        }
    }

    function setupGuestInterface() {
        // Ocultar elementos admin
        document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
        // Ocultar anuncio admin
        const ann = document.getElementById('adminAnnouncement');
        if (ann) ann.style.display = 'none';

        // Mostrar elementos b√°sicos para invitados
        document.querySelectorAll('.cliente-only').forEach(el => el.style.display = 'block');

        // Ocultar indicador de usuario, notificaciones y bot√≥n logout (si existen)
        const userIndicator = document.getElementById('userIndicator');
        if (userIndicator) userIndicator.style.display = 'none';
        const notificationContainer = document.getElementById('notificationContainer');
        if (notificationContainer) notificationContainer.style.display = 'none';
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) logoutBtn.style.display = 'none';

        // Ocultar carrito (invitado no puede ver bot√≥n)
        const cartBtn = document.getElementById('cartLeftBtn');
        if (cartBtn) cartBtn.style.display = 'none';

        // Cambiar el bot√≥n de login para mostrar que puede iniciar sesi√≥n
        const loginFloatingBtn = document.querySelector('.floating-buttons .btn-login');
        if (loginFloatingBtn) {
            loginFloatingBtn.style.display = 'flex';
        }

        // Personalizar mensaje de bienvenida para invitados
        const hero = document.getElementById('heroBienvenida');
        if (hero) hero.textContent = 'Comida tradicional Mexicana, disfruta del mejor sabor mexicano sin picante... pero conservando nuestro toque secreto';
        
        const titulo = document.getElementById('tituloInicio');
        if (titulo) titulo.textContent = '¬øQu√© te provoca hoy?';
    }

    function setupUserInterface(userEmail, userRole) {
        // Mostrar indicador de usuario si existe
        const userIndicator = document.getElementById('userIndicator');
        const emailSpan = document.getElementById('userEmail');
        const roleDisplay = document.getElementById('userRoleDisplay');
        if (userIndicator) userIndicator.style.display = 'block';
        if (emailSpan) emailSpan.textContent = userEmail;
        if (roleDisplay) {
            roleDisplay.textContent = userRole;
            roleDisplay.className = 'role-badge role-' + userRole;
        }

        // Mostrar sistema de notificaciones
        const notificationContainer = document.getElementById('notificationContainer');
        if (notificationContainer) notificationContainer.style.display = 'block';

        // Mostrar bot√≥n de logout
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) logoutBtn.style.display = 'flex';

        // Inicializar notificaciones para el usuario
        initializeNotifications(userRole);

        // Mostrar/ocultar carrito seg√∫n rol
        const cartBtn = document.getElementById('cartLeftBtn');
        if (cartBtn) {
            if (userRole === 'cliente') cartBtn.style.display = 'flex';
            else cartBtn.style.display = 'none';
        }

        // Personalizar interfaz seg√∫n rol
        if (userRole === 'admin') {
            setupAdminInterface(userEmail);
        } else {
            setupClienteInterface(userEmail);
        }
    }

    function setupClienteInterface(userEmail) {
        // Mostrar elementos cliente
        document.querySelectorAll('.cliente-only').forEach(el => el.style.display = 'block');

        // Ocultar elementos admin y anuncio (no corresponde a clientes)
        document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
        const ann = document.getElementById('adminAnnouncement');
        if (ann) ann.style.display = 'none';

        // Ocultar el bot√≥n de login flotante ya que est√° logueado
        const loginFloatingBtn = document.querySelector('.floating-buttons .btn-login');
        if (loginFloatingBtn) {
            loginFloatingBtn.style.display = 'none';
        }

        // Mostrar bot√≥n carrito para clientes
        const cartBtn = document.getElementById('cartLeftBtn');
        if (cartBtn) cartBtn.style.display = 'flex';

        // Personalizar mensajes
        const firstName = (userEmail || '').split('@')[0];
        const hero = document.getElementById('heroBienvenida');
        if (hero) hero.textContent = `¬°Hola ${firstName}! Disfruta del mejor sabor mexicano sin picante... pero conservando nuestro toque secreto.`;
    }

    function setupAdminInterface(userEmail) {
        // Ocultar el panel local en inicio (usaremos el PanelAdmin dedicado)
        const adminPanel = document.getElementById('adminPanel');
        if (adminPanel) adminPanel.style.display = 'none';

        // Mostrar anuncio / llamado al panel (en lugar del panel duplicado)
        const ann = document.getElementById('adminAnnouncement');
        if (ann) ann.style.display = 'block';

        // Mostrar enlace Panel Admin en el navbar (si existe)
        document.querySelectorAll('.admin-only').forEach(el => {
            if (el.tagName && el.tagName.toLowerCase() === 'a') el.style.display = 'inline-block';
            else el.style.display = 'block';
        });

        // Ocultar el bot√≥n de login flotante ya que est√° logueado
        const loginFloatingBtn = document.querySelector('.floating-buttons .btn-login');
        if (loginFloatingBtn) loginFloatingBtn.style.display = 'none';

        // Ocultar carrito para administradores
        const cartBtn = document.getElementById('cartLeftBtn');
        if (cartBtn) cartBtn.style.display = 'none';

        // Personalizar mensajes
        const hero = document.getElementById('heroBienvenida');
        if (hero) hero.textContent = `¬°Bienvenido Administrador! Gestiona tu restaurante Chilape√±o desde el Panel de Administrador.`;
        
        const titulo = document.getElementById('tituloInicio');
        if (titulo) titulo.textContent = '¬øQu√© quieres administrar hoy?';
    }

    function showClientePanel() {
        const currentUser = localStorage.getItem('currentUser');
        
        if (!currentUser) {
            // Si no est√° logueado, pedirle que se loguee
            if (confirm('Necesitas iniciar sesi√≥n para acceder a tu cuenta personal. ¬øQuieres iniciar sesi√≥n ahora?')) {
                window.location.href = 'login.html';
            }
            return;
        }
        
        alert('Panel de cliente - Aqu√≠ podr√≠as mostrar pedidos, favoritos, etc.');
    }

    // Funci√≥n para mostrar elementos que requieren autenticaci√≥n
    function requireAuth(callback) {
        const currentUser = localStorage.getItem('currentUser');
        
        if (!currentUser) {
            if (confirm('Esta funci√≥n requiere iniciar sesi√≥n. ¬øQuieres iniciar sesi√≥n ahora?')) {
                window.location.href = 'login.html';
            }
            return false;
        }
        
        return callback ? callback() : true;
    }

    function cerrarSesion() {
        localStorage.removeItem('currentUser');
        localStorage.removeItem('userRole');
        // Limpiar notificaciones del usuario actual
        notificationsData = [];
        window.location.href = 'login.html';
    }

    // ===========================
    // SISTEMA DE NOTIFICACIONES
    // ===========================

    let notificationsData = [];
    let unreadCount = 0;

    function initializeNotifications(userRole) {
        // Cargar notificaciones del localStorage
        const storageKey = 'chilape√±os_notifications_' + localStorage.getItem('currentUser');
        const savedNotifications = localStorage.getItem(storageKey);
        
        if (savedNotifications) {
            notificationsData = JSON.parse(savedNotifications);
        } else {
            // Generar notificaciones iniciales seg√∫n el rol
            generateInitialNotifications(userRole);
        }

        updateNotificationDisplay();
        
        // Cerrar dropdown cuando se hace clic fuera
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('notificationDropdown');
            const btn = document.getElementById('notificationBtn');
            
            if (dropdown && !dropdown.contains(event.target) && !btn.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });
    }

    function generateInitialNotifications(userRole) {
        const currentTime = new Date();
        
        if (userRole === 'admin') {
            notificationsData = [
                {
                    id: 1,
                    title: 'Bienvenido Administrador',
                    text: 'Has iniciado sesi√≥n como administrador. Tienes acceso completo al panel de control.',
                    time: formatNotificationTime(currentTime),
                    unread: true,
                    type: 'admin'
                },
                {
                    id: 2,
                    title: 'Sistema Actualizado',
                    text: 'El sistema de notificaciones ha sido implementado exitosamente.',
                    time: formatNotificationTime(new Date(currentTime.getTime() - 300000)),
                    unread: true,
                    type: 'system'
                },
                {
                    id: 3,
                    title: 'Recordatorio',
                    text: 'No olvides revisar las estad√≠sticas de usuarios y el funcionamiento del sistema.',
                    time: formatNotificationTime(new Date(currentTime.getTime() - 600000)),
                    unread: true,
                    type: 'reminder'
                }
            ];
        } else {
            notificationsData = [
                {
                    id: 1,
                    title: '¬°Bienvenido a Chilape√±os!',
                    text: 'Gracias por unirte a nuestra familia. Disfruta del mejor sabor mexicano.',
                    time: formatNotificationTime(currentTime),
                    unread: true,
                    type: 'welcome'
                },
                {
                    id: 2,
                    title: 'Promoci√≥n Especial',
                    text: '¬°Descuento del 15% en tu primera orden! Usa el c√≥digo: BIENVENIDO15',
                    time: formatNotificationTime(new Date(currentTime.getTime() - 300000)),
                    unread: true,
                    type: 'promo'
                },
                {
                    id: 3,
                    title: 'Horarios de Atenci√≥n',
                    text: 'Lun-Jue: 1:00-10:00 PM | Vie-S√°b: 1:00 PM-12:00 AM | Dom: 1:00 PM-9:00 PM',
                    time: formatNotificationTime(new Date(currentTime.getTime() - 900000)),
                    unread: false,
                    type: 'info'
                }
            ];
        }

        saveNotifications();
    }

    function formatNotificationTime(date) {
        const now = new Date();
        const diff = now - date;
        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(minutes / 60);
        const days = Math.floor(hours / 24);

        if (minutes < 1) return 'Ahora mismo';
        if (minutes < 60) return `Hace ${minutes}m`;
        if (hours < 24) return `Hace ${hours}h`;
        if (days < 7) return `Hace ${days}d`;
        return date.toLocaleDateString();
    }

    function toggleNotifications() {
        const dropdown = document.getElementById('notificationDropdown');
        const isVisible = dropdown.style.display === 'block';
        
        dropdown.style.display = isVisible ? 'none' : 'block';
        
        if (!isVisible) {
            updateNotificationsList();
        }
    }

    function updateNotificationDisplay() {
        const badge = document.getElementById('notificationBadge');
        unreadCount = notificationsData.filter(n => n.unread).length;
        
        if (unreadCount > 0) {
            badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
            badge.style.display = 'flex';
        } else {
            badge.style.display = 'none';
        }
    }

    function updateNotificationsList() {
        const listContainer = document.getElementById('notificationsList');
        
        if (notificationsData.length === 0) {
            listContainer.innerHTML = '<div class="no-notifications">No hay notificaciones</div>';
            return;
        }

        const notificationsHTML = notificationsData
            .sort((a, b) => b.id - a.id) // M√°s recientes primero
            .map(notification => `
                <div class="notification-item ${notification.unread ? 'unread' : ''}" 
                     onclick="markAsRead(${notification.id})">
                    <div class="notification-title">${notification.title}</div>
                    <div class="notification-text">${notification.text}</div>
                    <div class="notification-time">${notification.time}</div>
                </div>
            `).join('');

        listContainer.innerHTML = notificationsHTML;
    }

    function markAsRead(notificationId) {
        const notification = notificationsData.find(n => n.id === notificationId);
        if (notification && notification.unread) {
            notification.unread = false;
            saveNotifications();
            updateNotificationDisplay();
            updateNotificationsList();
        }
    }

    function clearNotifications() {
        notificationsData.forEach(n => n.unread = false);
        saveNotifications();
        updateNotificationDisplay();
        updateNotificationsList();
    }

    function addNotification(title, text, type = 'info') {
        const newNotification = {
            id: Date.now(), // ID √∫nico basado en timestamp
            title: title,
            text: text,
            time: formatNotificationTime(new Date()),
            unread: true,
            type: type
        };

        notificationsData.unshift(newNotification); // Agregar al principio
        
        // Mantener solo las √∫ltimas 20 notificaciones
        if (notificationsData.length > 20) {
            notificationsData = notificationsData.slice(0, 20);
        }

        saveNotifications();
        updateNotificationDisplay();
    }

    function saveNotifications() {
        const storageKey = 'chilape√±os_notifications_' + localStorage.getItem('currentUser');
        localStorage.setItem(storageKey, JSON.stringify(notificationsData));
    }

    // Funci√≥n para simular nueva notificaci√≥n (para pruebas)
    function simulateNewNotification() {
        const userRole = localStorage.getItem('userRole');
        
        if (userRole === 'admin') {
            const adminNotifications = [
                { title: 'Nuevo Usuario', text: 'Un nuevo cliente se ha registrado en el sistema.' },
                { title: 'Sistema', text: 'Backup autom√°tico completado exitosamente.' },
                { title: 'Alerta', text: 'Revisa las estad√≠sticas del d√≠a.' }
            ];
            const randomNotification = adminNotifications[Math.floor(Math.random() * adminNotifications.length)];
            addNotification(randomNotification.title, randomNotification.text, 'admin');
        } else {
            const clienteNotifications = [
                { title: 'Nueva Promoci√≥n', text: '¬°Descuento especial en platos fuertes!' },
                { title: 'Pedido', text: 'Tu pedido anterior fue calificado. ¬°Gracias!' },
                { title: 'Evento', text: 'Nuevo evento disponible en nuestra secci√≥n.' }
            ];
            const randomNotification = clienteNotifications[Math.floor(Math.random() * clienteNotifications.length)];
            addNotification(randomNotification.title, randomNotification.text, 'promo');
        }
    }

    // ===========================
    // FUNCIONES ADMIN (sin cambios funcionales importantes)
    // ===========================
    
    function showAdminPanel() {
        // Si la secci√≥n local adminPanel est√° oculta (porque en inicio usamos el PanelAdmin externo),
        // redirigimos al PanelAdmin.html; si est√° visible, hacemos scroll.
        const adminPanel = document.getElementById('adminPanel');
        if (adminPanel && (adminPanel.style.display === 'none' || getComputedStyle(adminPanel).display === 'none')) {
            window.location.href = 'PanelAdmin.html';
            return;
        }
        if (!requireAuth()) return;
        const userRole = localStorage.getItem('userRole');
        if (userRole !== 'admin') {
            alert('Acceso denegado. Solo los administradores pueden acceder a este panel.');
            return;
        }
        adminPanel.scrollIntoView({ behavior: 'smooth' });
    }

    function toggleUsersList() {
        if (!requireAuth()) return;
        
        const adminContent = document.getElementById('adminContent');
        const users = getUsers();
        
        adminContent.innerHTML = `
            <h3><i class="fas fa-users"></i> Lista de Usuarios</h3>
            <div class="user-list">
                ${users.map(user => `
                    <div class="user-item">
                        <div>
                            <strong>${user.email}</strong>
                        </div>
                        <span class="role-badge role-${user.role}">${user.role}</span>
                    </div>
                `).join('')}
            </div>
            <p style="margin-top: 15px; opacity: 0.8;">
                Total de usuarios: ${users.length}
            </p>
        `;
    }

    function showStats() {
        const users = getUsers();
        const adminCount = users.filter(u => u.role === 'admin').length;
        const clienteCount = users.filter(u => u.role === 'cliente').length;
        
        const adminContent = document.getElementById('adminContent');
        adminContent.innerHTML = `
            <h3><i class="fas fa-chart-bar"></i> Estad√≠sticas del Sistema</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">${users.length}</div>
                    <div>Total Usuarios</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${clienteCount}</div>
                    <div>Clientes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${adminCount}</div>
                    <div>Administradores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">24/7</div>
                    <div>Disponibilidad</div>
                </div>
            </div>
        `;
    }

    function toggleAdminTools() {
        const adminContent = document.getElementById('adminContent');
        adminContent.innerHTML = `
            <h3><i class="fas fa-cogs"></i> Herramientas de Administraci√≥n</h3>
            <div class="admin-buttons">
                <button class="admin-btn" onclick="clearAllUsers()">
                    <i class="fas fa-trash"></i><br>Limpiar Usuarios
                </button>
                <button class="admin-btn" onclick="exportData()">
                    <i class="fas fa-download"></i><br>Exportar Datos
                </button>
                <button class="admin-btn" onclick="showSystemInfo()">
                    <i class="fas fa-info-circle"></i><br>Info del Sistema
                </button>
            </div>
        `;
    }

    function showReports() {
        const adminContent = document.getElementById('adminContent');
        adminContent.innerHTML = `
            <h3><i class="fas fa-file-alt"></i> Reportes del Sistema</h3>
            <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                <p><strong>Reporte de Actividad:</strong></p>
                <ul style="list-style: none; padding: 0;">
                    <li style="padding: 5px 0;"><i class="fas fa-check text-success"></i> Sistema operativo</li>
                    <li style="padding: 5px 0;"><i class="fas fa-users"></i> ${getUsers().length} usuarios registrados</li>
                    <li style="padding: 5px 0;"><i class="fas fa-calendar"></i> √öltimo acceso: ${new Date().toLocaleString()}</li>
                    <li style="padding: 5px 0;"><i class="fas fa-server"></i> Almacenamiento: LocalStorage</li>
                </ul>
            </div>
        `;
    }

    // Funciones auxiliares
    function getUsers() {
        return JSON.parse(localStorage.getItem("usuarios")) || [];
    }

    function clearAllUsers() {
        if (confirm('¬øEst√°s seguro de eliminar todos los usuarios? Esta acci√≥n no se puede deshacer.')) {
            localStorage.removeItem("usuarios");
            alert('Usuarios eliminados exitosamente.');
            toggleUsersList(); // Actualizar vista
        }
    }

    function exportData() {
        const users = getUsers();
        const dataStr = JSON.stringify(users, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        
        const exportFileDefaultName = 'chilape√±os_usuarios.json';
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
    }

    function showSystemInfo() {
        const adminContent = document.getElementById('adminContent');
        adminContent.innerHTML = `
            <h3><i class="fas fa-info-circle"></i> Informaci√≥n del Sistema</h3>
            <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                <p><strong>Sistema Chilape√±os v1.0</strong></p>
                <p><strong>Navegador:</strong> ${navigator.userAgent.split(' ')[0]}</p>
                <p><strong>Fecha del sistema:</strong> ${new Date().toLocaleString()}</p>
                <p><strong>Storage utilizado:</strong> LocalStorage</p>
                <p><strong>Usuarios registrados:</strong> ${getUsers().length}</p>
                <p><strong>Estado:</strong> <span style="color: #4CAF50;">‚úì Online</span></p>
            </div>
        `;
    }

    // ===========================
    // SCRIPTS ORIGINALES (modo oscuro y smooth scroll)
    // ===========================
    
    function initializeUI() {
        // Modo oscuro (cambio de icono)
        const toggleBtn = document.getElementById("darkModeToggle");
        const body = document.body;

        if (toggleBtn) {
            toggleBtn.addEventListener("click", () => {
                body.classList.toggle("dark-mode");

                const icon = toggleBtn.querySelector("i");
                if (body.classList.contains("dark-mode")) {
                    icon.classList.remove("fa-moon");
                    icon.classList.add("fa-sun");
                } else {
                    icon.classList.remove("fa-sun");
                    icon.classList.add("fa-moon");
                }
            });
        }

        // Smooth scroll personalizado con easing (m√°s elegante)
        // Duraci√≥n por defecto: 1200 ms (ajusta si quieres m√°s lento o m√°s r√°pido)
        function easeInOutCubic(t) {
            return t < 0.5
                ? 4 * t * t * t
                : 1 - Math.pow(-2 * t + 2, 3) / 2;
        }

        function smoothScrollToElement(targetElem, duration = 1200, offset = 0) {
            const startY = window.pageYOffset;
            const targetRect = targetElem.getBoundingClientRect();
            const targetY = targetRect.top + startY + offset;
            const distance = targetY - startY;
            let startTime = null;

            function animation(currentTime) {
                if (!startTime) startTime = currentTime;
                const timeElapsed = currentTime - startTime;
                const progress = Math.min(timeElapsed / duration, 1);
                const eased = easeInOutCubic(progress);
                window.scrollTo(0, Math.round(startY + distance * eased));
                if (timeElapsed < duration) {
                    requestAnimationFrame(animation);
                }
            }

            requestAnimationFrame(animation);
        }

        // Enlaza el bot√≥n "Explora el men√∫" con el scroll elegante
        const scrollBtn = document.getElementById("scrollToMenu");
        if (scrollBtn) {
            scrollBtn.addEventListener("click", function(e) {
                e.preventDefault();
                const target = document.getElementById("categorias");
                if (!target) return;

                const navbar = document.querySelector(".navbar");
                const navHeight = navbar ? navbar.offsetHeight : 0;
                const offset = - (navHeight + 12); // separa la secci√≥n de la navbar

                smoothScrollToElement(target, 1200, offset);
            });
        }

        // Conectar bot√≥n carrito (si existe)
        const cartBtn = document.getElementById('cartLeftBtn');
        if (cartBtn) {
            cartBtn.addEventListener('click', () => {
                const user = localStorage.getItem('currentUser');
                const role = localStorage.getItem('userRole');
                if (!user || role !== 'cliente') {
                    showAuthModal();
                    return;
                }
                showCartModal();
            });
        }
    }

    /* ===========================
       CARRITO (funciones reutilizables)
       - Persistencia: localStorage por usuario (chilap_cart_<currentUser>)
       - addToCart(name, price, img) disponible globalmente para usar en p√°ginas de productos
       =========================== */

    function getCartKey() {
        const user = localStorage.getItem('currentUser') || 'guest';
        return 'chilap_cart_' + user;
    }

    function loadCart() {
        try {
            const raw = localStorage.getItem(getCartKey());
            return raw ? JSON.parse(raw) : [];
        } catch (e) {
            return [];
        }
    }

    function saveCart(cart) {
        localStorage.setItem(getCartKey(), JSON.stringify(cart));
    }

    function formatCurrency(n) {
        // Mostrar en formato COP sin decimales
        return n.toLocaleString('es-CO', { style: 'currency', currency: 'COP', maximumFractionDigits: 0 });
    }

    function updateCartBadge() {
        const cart = loadCart();
        const qty = cart.reduce((s, i) => s + (i.qty || 0), 0);
        const badge = document.getElementById('cartLeftBadge');
        if (!badge) return;
        if (qty > 0) {
            badge.style.display = 'flex';
            badge.textContent = qty > 99 ? '99+' : qty;
        } else {
            badge.style.display = 'none';
        }
    }

    // A√±adir producto al carrito (puedes llamar a esta funci√≥n desde otras p√°ginas)
    function addToCart(name, price, img) {
        const user = localStorage.getItem('currentUser');
        const role = localStorage.getItem('userRole');

        // Solo clientes pueden a√±adir; si no est√° logueado o no es cliente, mostrar modal para iniciar sesi√≥n
        if (!user || role !== 'cliente') {
            showAuthModal();
            return false;
        }

        const cart = loadCart();
        const existing = cart.find(i => i.name === name);
        if (existing) existing.qty = (existing.qty || 1) + 1;
        else cart.push({ id: Date.now(), name, price: Number(price), qty: 1, img: img || '' });

        saveCart(cart);
        updateCartBadge();
        return true;
    }

    // Modal (autenticaci√≥n y carrito)
    const backdrop = document.getElementById('modalBackdrop');
    const modal = document.getElementById('modal');

    function openModal() { backdrop.style.display = 'flex'; backdrop.setAttribute('aria-hidden','false'); }
    function closeModal() { backdrop.style.display = 'none'; backdrop.setAttribute('aria-hidden','true'); modal.innerHTML = ''; }

    backdrop.addEventListener('click', (e) => {
        if (e.target === backdrop) closeModal();
    });

    function showAuthModal() {
        modal.innerHTML = `
            <h3>Inicia sesi√≥n para usar el carrito</h3>
            <div class="modal-body">
                <p>Debes iniciar sesi√≥n como cliente para a√±adir productos y ver el carrito.</p>
            </div>
            <div class="modal-footer">
                <div>
                    <button class="btn-secondary" id="closeAuth">Cerrar</button>
                </div>
                <div>
                    <button class="btn-primary" id="goLogin">Iniciar sesi√≥n</button>
                </div>
            </div>
        `;
        document.getElementById('closeAuth').addEventListener('click', closeModal);
        document.getElementById('goLogin').addEventListener('click', () => { window.location.href = 'login.html'; });
        openModal();
    }

    function showCartModal() {
        const cart = loadCart();
        if (!cart.length) {
            modal.innerHTML = `
                <h3>Tu carrito</h3>
                <div class="modal-body"><p>Tu carrito est√° vac√≠o.</p></div>
                <div class="modal-footer"><button class="btn-secondary" id="closeEmpty">Cerrar</button></div>
            `;
            document.getElementById('closeEmpty').addEventListener('click', closeModal);
            openModal();
            return;
        }

        const itemsHtml = cart.map(i => `
            <div class="cart-item" data-name="${escapeHtml(i.name)}">
                <img src="${escapeHtml(i.img || '')}" alt="${escapeHtml(i.name)}" onerror="this.style.display='none'">
                <div class="meta">
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <strong>${escapeHtml(i.name)}</strong>
                        <div><strong>${formatCurrency(i.price)}</strong></div>
                    </div>
                    <div style="margin-top:8px; display:flex; align-items:center; gap:10px;">
                        <div class="qty-controls">
                            <button class="qty-decrease" data-name="${escapeHtml(i.name)}">-</button>
                            <div style="min-width:24px;text-align:center;">${i.qty}</div>
                            <button class="qty-increase" data-name="${escapeHtml(i.name)}">+</button>
                        </div>
                        <button class="remove-btn" data-name="${escapeHtml(i.name)}">Eliminar</button>
                    </div>
                </div>
            </div>
        `).join('');

        const total = cart.reduce((s,i) => s + (i.price * (i.qty || 1)), 0);

        modal.innerHTML = `
            <h3>Tu carrito</h3>
            <div class="modal-body">
                ${itemsHtml}
            </div>
            <div class="modal-footer">
                <div><strong>Total:</strong> ${formatCurrency(total)}</div>
                <div style="display:flex;gap:8px;">
                    <button class="btn-secondary" id="closeCart">Cerrar</button>
                    <button class="btn-primary" id="checkoutBtn">Pagar</button>
                </div>
            </div>
        `;

        // enlazar controles
        modal.querySelectorAll('.qty-increase').forEach(btn => {
            btn.addEventListener('click', () => {
                const name = btn.dataset.name;
                const cart = loadCart();
                const item = cart.find(x => x.name === name);
                if (!item) return;
                item.qty = (item.qty || 1) + 1;
                saveCart(cart);
                showCartModal();
                updateCartBadge();
            });
        });

        modal.querySelectorAll('.qty-decrease').forEach(btn => {
            btn.addEventListener('click', () => {
                const name = btn.dataset.name;
                const cart = loadCart();
                const item = cart.find(x => x.name === name);
                if (!item) return;
                item.qty = (item.qty || 1) - 1;
                if (item.qty <= 0) {
                    const idx = cart.findIndex(x => x.name === name);
                    if (idx !== -1) cart.splice(idx, 1);
                }
                saveCart(cart);
                showCartModal();
                updateCartBadge();
            });
        });

        modal.querySelectorAll('.remove-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const name = btn.dataset.name;
                const cart = loadCart();
                const idx = cart.findIndex(x => x.name === name);
                if (idx !== -1) cart.splice(idx, 1);
                saveCart(cart);
                showCartModal();
                updateCartBadge();
            });
        });

        document.getElementById('closeCart').addEventListener('click', closeModal);
        document.getElementById('checkoutBtn').addEventListener('click', () => {
            alert('Simulaci√≥n de pago: aqu√≠ implementar√≠as tu flujo de checkout.');
            closeModal();
            // window.location.href = 'carrito.html'; // si tienes una vista dedicada
        });

        openModal();
    }

    /* ===========================
       Helpers
       =========================== */

    function escapeHtml(str) {
        if (!str) return '';
        return String(str).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; });
    }

</script>

</body>
</html>
